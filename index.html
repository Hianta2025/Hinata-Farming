<!DOCTYPE html>
<html>
<head>
    <title>Login Page with Messaging</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 100px;
            background-color: black;
            color: white;
        }
        .login-box {
            width: 350px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #222;
        }
        input {
            width: 90%;
            padding: 10px;
            margin: 10px 0;
            background-color: #333;
            color: white;
            border: 1px solid #555;
        }
        .input-group {
            display: flex;
            gap: 10px;
        }
        .input-group input {
            width: 45%;
        }
        button {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #555;
            color: white;
            border: none;
            border-radius: 5px;
        }
        .messages-box {
            width: 350px;
            margin: auto;
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #333;
            color: white;
            height: 300px;
            overflow-y: scroll;
        }
    </style>
</head>
<body>
    <div class="login-box">
        <h2>Login</h2>
        <div class="input-group">
            <input type="text" id="teamname" placeholder="Team Name" required>
            <input type="text" id="username" placeholder="Username" required>
        </div>
        <input type="password" id="password" placeholder="Password" required><br>
        <button onclick="login()">Login</button>
        <button onclick="register()">Register</button>
        <p id="error-msg" style="color: red;"></p>
    </div>

    <div class="messages-box">
        <h3>Messages</h3>
        <div id="messages"></div>
        <input type="text" id="message" placeholder="Type a message...">
        <button onclick="sendMessage()">Send</button>
    </div>

    <script>
        var users = JSON.parse(localStorage.getItem("users")) || {}; // Load stored users
        var messages = JSON.parse(localStorage.getItem("messages")) || [];
        var adminPassword = "Hannah01."; // Admin approval password

        function saveUsers() {
            localStorage.setItem("users", JSON.stringify(users));
        }

        function register() {
            var teamname = document.getElementById("teamname").value;
            var username = document.getElementById("username").value;
            var password = document.getElementById("password").value;
            var errorMsg = document.getElementById("error-msg");
            
            if (!teamname || !username || !password) {
                errorMsg.innerText = "Team Name, Username, and Password required!";
                return;
            }
            
            if (users[username]) {
                errorMsg.innerText = "Username already taken!";
            } else {
                users[username] = { teamname: teamname, password: password, approved: false };
                saveUsers();
                errorMsg.innerText = "Registration successful! Waiting for admin approval.";
            }
        }

        function login() {
            var username = document.getElementById("username").value;
            var password = document.getElementById("password").value;
            var errorMsg = document.getElementById("error-msg");

            if (!users[username]) {
                errorMsg.innerText = "User not found!";
                return;
            }
            
            if (!users[username].approved) {
                errorMsg.innerText = "Account not approved by admin!";
                return;
            }

            if (users[username].password === password) {
                sessionStorage.setItem("loggedInUser", username);
                alert("Login successful!");
                displayMessages();
            } else {
                errorMsg.innerText = "Invalid password!";
            }
        }

        function sendMessage() {
            var message = document.getElementById("message").value;
            var username = sessionStorage.getItem("loggedInUser");
            if (!username) {
                alert("You must log in first!");
                return;
            }
            if (message.trim() === "") return;

            var newMessage = { user: username, text: message };
            messages.push(newMessage);
            localStorage.setItem("messages", JSON.stringify(messages));
            displayMessages();
            document.getElementById("message").value = "";
        }

        function displayMessages() {
            var messageBox = document.getElementById("messages");
            messageBox.innerHTML = "";
            messages.forEach(msg => {
                var msgDiv = document.createElement("div");
                msgDiv.textContent = msg.user + ": " + msg.text;
                messageBox.appendChild(msgDiv);
            });
        }
        
        displayMessages(); // Show messages on load

        function approveUser() {
            let pendingUsers = Object.keys(users).filter(username => !users[username].approved);

            if (pendingUsers.length === 0) {
                alert("No users pending approval.");
                return;
            }

            let username = prompt("Enter username to approve (Pending: " + pendingUsers.join(", ") + "):");
            let adminPass = prompt("Enter admin password:");

            if (adminPass === adminPassword) {
                if (users[username]) {
                    users[username].approved = true;
                    saveUsers();
                    alert(username + " has been approved!");
                } else {
                    alert("User not found! Check the username again.");
                }
            } else {
                alert("Incorrect admin password!");
            }
        }
    </script>
    <br>
    <button onclick="approveUser()">Admin Approve User</button>
</body>
</html>
